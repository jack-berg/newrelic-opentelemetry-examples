receivers:
  redis:
    endpoint: ${REDIS_HOST}:${REDIS_PORT}
    metrics:
      # Enable redis.maxmemory optional metric
      redis.maxmemory:
        enabled: true

processors:
  batch:
  # This is required for New Relic entity synthesis. The redis receiver does not currently include any identifying attributes on the metrics it produces.
  attributes/redis_metrics:
    include:
      match_type: regexp
      metric_names:
        # Notice that if with single or without quotes just one backslash is needed 'redis\..*'
        - "redis\\..*"
    actions:
      - action: upsert
        key: server.address
        value: ${REDIS_HOST}
      - action: upsert
        key: server.port
        value: ${REDIS_PORT}

exporters:
  logging:
    verbosity: detailed
  otlphttp:
    endpoint: $NEW_RELIC_OTLP_ENDPOINT
    headers:
      api-key: $NEW_RELIC_API_KEY

service:
  pipelines:
    metrics:
      receivers: [redis]
      processors: [attributes/redis_metrics, batch]
      exporters: [logging, otlphttp]
